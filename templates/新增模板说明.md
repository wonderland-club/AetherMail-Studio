# 新增模板说明

在 `templates/<template_id>/` 下添加模板时，请遵循以下规则：

1. 目录命名：`<template_id>` 全局唯一，建议与 `TEMPLATE_ID` 一致。
2. 必备文件：
   - `template.md`：邮件正文 Markdown，使用 `{{&VAR}}` 占位符。
   - `template.py`：定义模板元数据与渲染函数。
3. `template.py` 参考结构：
```python
from pathlib import Path
from datetime import datetime

TEMPLATE_ID = "your_id"
DESCRIPTION = "模板描述（给自己看的）"
DEFAULT_SUBJECT = "默认主题"
REQUIRED_FIELDS = ["REQUIRED_VAR"]  # 与 {{&REQUIRED_VAR}} 对应

def get_subject(data):
    # 如需动态主题，返回字符串；否则可删除此函数
    return DEFAULT_SUBJECT

def render(data, renderer):
    md_path = Path(__file__).with_name("template.md")
    md_text = md_path.read_text(encoding="utf-8")
    data = dict(data or {})
    # 例：自动填充当前时间（可选）
    data.setdefault("CURRENT_TIME", datetime.now().strftime("%Y-%m-%d %H:%M:%S"))
    return renderer.render(md_text, data)
```
4. 占位符规则：`{{&VAR}}`，变量名需在请求 `data` 中提供，或在 `render` 内补充；缺失会报错。
5. 请求体示例：
```json
{
  "template": "your_id",
  "to": "user@example.com",
  "cc": [],
  "data": {"REQUIRED_VAR": "value"}
}
```
6. 无需修改后端：文件就绪后重启服务（或在代码里调用 registry.reload）。
